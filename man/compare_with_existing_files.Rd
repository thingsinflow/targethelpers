% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rows_to_files.R
\name{compare_with_existing_files}
\alias{compare_with_existing_files}
\title{Compare New or Changed Rows with Existing Files}
\usage{
compare_with_existing_files(
  new_data_df_w_filepaths,
  cols_not_to_compare = c(),
  id_col_name = "id",
  path,
  file_prefix,
  extension = ".qs2"
)
}
\arguments{
\item{new_data_df_w_filepaths}{A data frame containing the current data and a
\code{file_path} column that points to where each row should be stored as
separate files.}

\item{cols_not_to_compare}{Character vector of columns to exclude from
comparison (default is \code{"images"}).}

\item{id_col_name}{Name of the unique identifier column (default \code{"id"}).}

\item{path}{Directory containing existing files (default
\code{"data_in/boliga_current"}).}

\item{file_prefix}{Prefix used for the filenames (default \code{"estate"}).}

\item{extension}{File extension to match - must be either \code{".qs2"} or
\code{".parquet"} (default \code{".qs2"}).}
}
\value{
A character vector of IDs that are new or have changed.
}
\description{
Identifies rows in the input data frame that are new or have changed compared
to previous data stored in existing files under \code{path}. Specific columns that
change often (e.g., timestamps) can be specified as such and ignored during
comparison.
}
\details{
This is one of three helper functions that work together to keep a
set of per‑property files in sync with the live Boliga dataset:
\enumerate{
\item \strong{\code{compare_with_existing_files()}} Takes the current data frame and
compares every row (ignoring columns that change only because of
timestamps) against the already stored files in the \code{path} directory.
Returns the IDs of rows that are new or have changed.
\item \strong{\code{save_each_row_as_a_separate_file()}} Receives the subset of rows
identified as new/changed and writes each of the rows to its own file
(\verb{estate_<id>.qs2} or \verb{estate_<id>.parquet}). The function returns the
paths of the files it created, which can be useful for debugging or
logging.
\item \strong{\code{delete_existing_files_w_ids_not_present_in_current_data()}} Looks at
all existing files in the directory and removes any whose ID is no longer
present in the current data frame. It returns the list of deleted file
paths.
}

Finally, the pipeline step returns a vector of the current file paths to
all of the files in the \code{path} directory, so that \code{targets} can monitor
these files for downstream steps. This workflow ensures that only
up‑to‑date property records are kept in the input directory and stale ones
are automatically purged.

All of this is done in order for making it possible for \code{targets} to use
it's branching magic to run the pipeline as efficiently as possible.
}
\seealso{
These functions are designed to work together, see details above:
\code{\link[=compare_with_existing_files]{compare_with_existing_files()}}, \code{\link[=save_each_row_as_a_separate_file]{save_each_row_as_a_separate_file()}},
\code{\link[=delete_existing_files_w_ids_not_present_in_current_data]{delete_existing_files_w_ids_not_present_in_current_data()}}
}
