% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rows_to_files.R
\name{rows_as_files}
\alias{rows_as_files}
\title{Convert the rows of a data frame to individual files}
\usage{
rows_as_files(
  data_df,
  cols_not_to_compare = c(),
  id_col_name = "id",
  path = "data_in",
  file_prefix = "item",
  extension = ".qs2"
)
}
\arguments{
\item{data_df}{A data frame containing the rows to be written as separate
files.}

\item{cols_not_to_compare}{Character vector of column names that should be
ignored when determining if a row has changed (e.g. automatically updated
timestamps).  Defaults to none.}

\item{id_col_name}{Name of the column that uniquely identifies each row; used
for file naming and comparison. Defaults to "id".}

\item{path}{Directory where the files will be written; created if it does not
exist. Defaults to "data_in".}

\item{file_prefix}{Prefix added to each generated file name.  Defaults to
"item".}

\item{extension}{File extension (including leading dot) used when saving
files. Defaults to ".qs2".}
}
\value{
A list with five components that summarises the actions taken:
\describe{
\item{data_w_file_paths}{Data frame augmented with the full path of each rowâ€™s file.}
\item{ids_new_or_changed_rows}{Vector of ids for rows that are new or have changed.}
\item{changes}{Data frame with summary of what has changed. Each row lists \code{id}, \code{changed_cols}, \code{old}, \code{new}, with \code{old} and \code{new} encoded as JSON.}
\item{new_or_updated_files}{Character vector of paths to files that were created or updated.}
\item{deleted_files}{Character vector of paths to files that were removed because the row is no longer present.}
}
}
\description{
Writes each row of a data frame as a separate file, updates changed rows, and
removes files for rows that are no longer present. Useful as input for
monitoring input files in a Targets pipeline.
}
\details{
The function creates a directory if needed, compares existing files
to the current data (ignoring specified columns), writes new or updated
rows, deletes obsolete files, and returns a summary of actions taken.
}
\examples{
# Example usage
df <- data.frame(id = 1:3, value = c("a", "b", "c"))
result <- rows_as_files(df, path = "data_out")
unlink("data_out", recursive = TRUE)

if (require("rmarkdown") & require("visNetwork")) {
# Typical use case as part of a targets pipeline
targets::tar_dir({ # tar_dir() runs code from a temporary directory.

# Generate a rmarkdown document:
lines <- c(
  "---",
  "title: Run Summary",
  "output_format: html",
  "---",
  "## Status for the `targets` pipeline",
  "```{r, as.is=TRUE, echo= FALSE}",
  "targets::tar_glimpse()",
  "```",
  "### Stats",
  "```{r, echo=FALSE}",
  "timestamps <- targets::tar_meta()$time |> na.omit()",
  "```",
  "Started: `r min(timestamps)` \n\nRan for:
  `r round(max(timestamps) - min(timestamps), digits = 2)` secs\n",
  "### Data fetched",
  "```{r}",
  "data <- targets::tar_read(data)",
  "dplyr::glimpse(data)",
  "```",
  "### Rows converted to files",
  "Read summary data...",
  "```{r}",
  "rows_as_files_status <- targets::tar_read(rows_as_files)",
  "```",
  "...and print it out.\n",
  "#### IDs for new or changed rows",
  "```{r}",
  "rows_as_files_status$ids_new_or_changed_rows",
  "```",
  "#### Changes compared to previous run (if any)",
  "```{r}",
  "rows_as_files_status$changes",
  "```",
  "#### Paths to all new or updated files (if any)",
  "#### ",
  "```{r}",
  "rows_as_files_status$new_or_updated_files |> base::print(max=20)",
  "```",
  "### Pipeline output (=data read back from the files)",
  "```{r}",
  "targets::tar_read(whatever)",
  "```"
)
writeLines(lines, "report.rmd")

targets::tar_script({

  library(targets)
  library(tarchetypes)

  list(
    tar_target(
        name = data,
        command = jsonlite::fromJSON("https://cranlogs.r-pkg.org/top/last-month/100")$downloads
    ),
    tar_target(
        name = rows_as_files,
        command = data |>
            targethelpers::rows_as_files(id_col_name = "package", extension = ".rds"),
        format = "rds"
    ),
    tar_files(
        name = input,
        command = rows_as_files$data_w_file_paths$file_path
    ),
    tar_target(
        name = whatever,
        command = input |>
            readRDS()
        # Your code here
        ,
        pattern = map(input)
    ),
    tar_render(
        name = report,
        path = "report.rmd"
    )
  )
})
targets::tar_make()
targets::tar_read(whatever)
utils::browseURL("report.html")
# Make sure the report has time to be rendered before the script terminates
Sys.sleep(1)
})
}
}
